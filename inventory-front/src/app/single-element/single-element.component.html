<div class="max-w-4xl mx-auto p-6 bg-white rounded-2xl shadow-sm mt-8">
  <button (click)="volver()"
    class="flex items-center gap-2 mb-6 text-primary_darker hover:text-secondary-dark transition">
    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#24842C">
      <path d="m313-440 224 224-57 56-320-320 320-320 57 56-224 224h487v80H313Z" />
    </svg>
    Volver al inventario
  </button>

  <!-- Vista normal para campos principales -->
  <ng-container *ngIf="!modoEdicion">
    <h2 class="text-3xl font-bold mb-4">{{ elemento.nombre || elemento.personalId }}</h2>
    <p><strong>ID personal:</strong> {{ elemento.personalId }}</p>
    <p><strong>Descripción:</strong> {{ elemento.descripcion }}</p>
    <p><strong>Ubicación:</strong> {{ elemento.ubicacion }}</p>
  </ng-container>

  <!-- Vista de edición para campos principales -->
  <ng-container *ngIf="modoEdicion">
    <div class="space-y-4">
      <label class="block">
        <span class="text-gray-700 font-bold">Nombre:</span>
        <input type="text" [(ngModel)]="elemento.nombre" class="mt-1 block w-full rounded-lg border-2 border-gray-300 shadow-sm p-2 h-10 focus:outline-none focus:ring-2 focus:ring-green-500" />
      </label>
      <label class="block">
        <span class="text-gray-700 font-bold">Descripción:</span>
        <input type="text" [(ngModel)]="elemento.descripcion" class="mt-1 block w-full rounded-lg border-2 border-gray-300 shadow-sm p-2 h-10 focus:outline-none focus:ring-2 focus:ring-green-500" />
      </label>
      <label class="block">
        <span class="text-gray-700 font-bold">Ubicación:</span>
        <input type="text" [(ngModel)]="elemento.ubicacion" class="mt-1 block w-full rounded-lg border-2 border-gray-300 shadow-sm p-2 h-10 focus:outline-none focus:ring-2 focus:ring-green-500" />
      </label>
    </div>
  </ng-container>

  <p><strong>Valor total:</strong> ${{ elemento.valorCalculado | number }}</p>

  <hr class="my-4">

  <h3 class="text-xl font-semibold mb-2">Componentes asociados:</h3>

  <!-- Vista normal -->
  <ul *ngIf="!modoEdicion">
    <li *ngFor="let comp of elemento.componentes">
      <ng-container *ngIf="obtenerElementoSimple(comp.elementoId) as simple">
        {{ simple.nombre }} ({{ simple.tipo }}) — Cantidad: {{ comp.cantidad }} — Valor: ${{ simple.valorUnitario | number }}
      </ng-container>
    </li>
  </ul>

  <!-- Vista edición -->
  <div *ngIf="modoEdicion" class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div *ngFor="let comp of elemento.componentes; let i = index" class="border rounded-lg p-4 bg-gray-50 shadow">
      <ng-container *ngIf="obtenerElementoSimple(comp.elementoId) as simple">
        <h4 class="font-semibold">{{ simple.nombre }}</h4>
        <p>{{ simple.tipo }}</p>

        <!-- Campo de edición de Valor Unitario -->
        <label class="block mt-2 text-sm">
          <span class="text-gray-700 font-bold">Valor unitario:</span>
          <input type="number" [(ngModel)]="simple.valorUnitario" min="0" class="border-2 rounded-lg px-2 py-1 w-28 h-10 focus:outline-none focus:ring-2 focus:ring-green-500" />
        </label>

        <!-- Campo de edición de Cantidad -->
        <label class="block mt-2 text-sm">
          <span class="text-gray-700 font-bold">Cantidad:</span>
          <input type="number" [(ngModel)]="comp.cantidad" min="1" class="border-2 rounded-lg px-2 py-1 w-20 h-10 focus:outline-none focus:ring-2 focus:ring-green-500" />
        </label>
        
        <button (click)="eliminarComponente(i)" class="mt-2 bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded">Eliminar</button>
      </ng-container>
    </div>
  </div>

  <!-- Agregar existente -->
  <div *ngIf="modoEdicion" class="mt-6">
    <label class="block mb-2">
      <span class="text-gray-700 font-bold">Agregar componente existente:</span>
    </label>
    <div class="flex items-center gap-2">
      <select [(ngModel)]="nuevoElementoId" class="border-2 rounded-lg px-2 py-1 h-10 focus:outline-none focus:ring-2 focus:ring-green-500">
        <option value="">-- Seleccionar --</option>
        <option *ngFor="let simple of elementosSimples" [value]="simple.id">
          {{ simple.nombre }} ({{ simple.tipo }})
        </option>
      </select>
      <button (click)="agregarComponenteExistente()" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-lg h-10">Agregar</button>
    </div>
  </div>

  <!-- Crear nuevo -->
   <div *ngIf="modoEdicion" class="mt-6 border-t pt-4">
        <app-add-new-simple-button></app-add-new-simple-button>
      </div>
  <!-- Botones -->
  <div class="mt-6 flex gap-4">
    <button *ngIf="!modoEdicion" (click)="editarElemento()"
      class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF">
        <path
          d="M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm640-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z" />
      </svg>
      Editar
    </button>
    <button *ngIf="modoEdicion" (click)="guardarCambios()"
      class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">Guardar cambios</button>
    <button *ngIf="modoEdicion" (click)="cancelarEdicion()"
      class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-lg">Cancelar</button>
    <button (click)="toggleNotas()" class="bg-secondary hover:bg-secondary_dark text-white px-4 py-2 rounded-lg">
      {{ mostrarNotas ? 'Ocultar notas' : (elemento.nota ? 'Ver notas' : 'Agregar nota') }}
    </button>
  </div>

  <!-- Notas -->
  <div *ngIf="mostrarNotas" class="mt-4 p-4 border rounded-lg bg-gray-50">
    <textarea [(ngModel)]="elemento.nota" class="w-full min-h-[100px] p-2 border rounded-lg"></textarea>
    <button (click)="guardarNota()" class="mt-2 bg-green-600 hover:bg-green-700 text-white px-4 py-1 rounded-lg">Guardar
      nota</button>
  </div>
</div>
